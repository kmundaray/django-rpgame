<!-- rpgame/templates/index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'node_modules/bootstrap/dist/css/bootstrap.min.css' %}" />
    <!-- Stylesheet -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">

    <title>RP Game</title>
</head>

<body>

    <!-- // Reload button // -->
    <button id="reloadButton">Refresh Page</button>

    <!-- Custom button for sending a message to the server -->
    <button id="updateContentButton">Update Content</button>

    <h1>Welcome to the RP Game project</h1>

    {% comment %}
    Django template tags are enclosed in {% and %}.
    Use these tags to insert dynamic content or perform logic.
    {% endcomment %}

    <!-- Form for user input -->
    <form method="post" action="{% url 'loginform' %}">
        {% csrf_token %}
        <label for="user_login">Login:</label>
        <input type="text" id="user_login" name="user_login">
        <label for="user_password">Password:</label>
        <input type="text" id="user_password" name="user_password">
        <button type="submit" id="submit">Submit</button>
    </form>

    <!-- Display area for server responses -->
    <div id="updateContent"></div>

    {% if user_login %}
    <p>Login entered: {{ user_login }}</p>
    {% endif %}

    <!-- Some other content -->

    {% if user_password %}
    <p>Password entered: {{ user_password }}</p>
    {% endif %}

    <h1>WebSocket Test</h1>
    <input type="text" id="messageInput" placeholder="Type a message">
    <button onclick="sendMessage()">Send Message</button>
    <ul id="messageList"></ul>




    <!-- // WebSocket connection script // Javascript code // -->
    <script>
        // WebSocket connection code (if applicable)
        const socket = new WebSocket('ws://' + window.location.host + '/ws/RpGameConsumer/');

        // Ensure the WebSocket Connection is Open
        socket.onopen = function (event) {
            console.log('WebSocket connection opened:', event);
            // You can send an initial message if needed
            // socket.send('Hello, WebSocket!');
        };

        socket.onmessage = (event) => {
            console.log('WebSocket message received:', event);
            const messageList = document.getElementById('messageList');
            const listItem = document.createElement('li');
            listItem.textContent = event.data;
            messageList.appendChild(listItem);
        };

        // Function to reload the page
        function reloadPage() {
            location.reload();
        }

        // Event listener for the button click
        document.getElementById('reloadButton').onclick = function () {
            reloadPage();
        };

        // Function to reload the page every 5 seconds (adjust as needed)
        // function autoRefresh() {
        //     location.reload();
        // }

        // SetInterval to call the autoRefresh function every 5000 milliseconds (5 seconds)
        // setInterval(autoRefresh, 5000);

        socket.onclose = function (event) {
            // Handle WebSocket closure, if needed
            console.log('WebSocket closed:', event);
        };

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;

            if (message.trim() !== '') {
                socket.send(message);
                messageInput.value = '';
            }
        }

        // Set up an event listener for the update content button click
        document.getElementById('updateContentButton').onclick = function () {
            // Update the content of the target element
            document.getElementById('updateContent').innerHTML = 'Changed block after clicking on Update Content button';
        };
    </script>

    <!-- Bootstrap JavaScript plugins -->
    <script src="../static/node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>

</body>

</html>